name: Compile and Debug Hello World

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  compile-and-debug:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Install build tools
        run: |
          sudo apt-get update
          sudo apt-get install -y gcc gdb
      
      - name: Compile Hello World program
        run: |
          gcc -g -o hello_world hello_world.c
          echo "Compilation successful!"
      
      - name: Run Hello World program
        run: |
          ./hello_world
      
      - name: Debug Hello World program
        run: |
          # Create a GDB command file
          cat > gdb_commands.txt << 'EOF'
          # Set a breakpoint at main
          break main
          # Run the program
          run
          # Print the call stack
          backtrace
          # Continue execution
          continue
          # Quit GDB
          quit
          EOF
          
          # Run GDB with the command file
          echo "Running GDB debugger..."
          gdb -batch -x gdb_commands.txt ./hello_world
      
      - name: Show binary information
        run: |
          echo "Binary file information:"
          file hello_world
          echo ""
          echo "Binary size:"
          ls -lh hello_world
          echo ""
          echo "Symbols in binary:"
          nm hello_world | head -20
